<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>OD on the GO â€“ Conference Games</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#fafafa;
  margin:0;
}
.wrap{
  max-width:1100px;
  margin:24px auto;
  padding:0 14px;
  text-align:center;
}
.toggleBar{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  margin:16px 0 20px;
}
.toggleBtn{
  padding:12px 16px;
  border-radius:10px;
  border:1px solid #ccc;
  background:#fff;
  font-weight:900;
  cursor:pointer;
}
.toggleBtn.active{
  background:#111;
  color:#fff;
}
.panel{
  display:none;
  background:#fff;
  border:1px solid #eee;
  border-radius:16px;
  padding:18px;
  box-shadow:0 2px 12px rgba(0,0,0,.06);
}
.panel.active{display:block;}
.note{font-size:12px;color:#666;margin-top:10px;}
.action{
  margin-top:14px;
  padding:12px 18px;
  font-size:16px;
  font-weight:900;
  border:none;
  border-radius:10px;
  background:#111;
  color:#fff;
  cursor:pointer;
}
.result{
  display:none;
  margin:14px auto 0;
  padding:14px;
  max-width:520px;
  border:1px solid #cce5ff;
  background:#f0f7ff;
  border-radius:12px;
}
.result .big{font-size:22px;font-weight:900;}
.result .small{font-size:13px;color:#444;margin-top:6px;}
</style>
</head>

  <script>
(() => {
  // ---- Safe helper (so one error won't nuke the whole page)
  function safe(fn){
    try { fn(); } catch(e){ console.error(e); }
  }

  // ---- Prize odds
  const PROB_50 = 0.08; // ~8% rare
  function choosePrize(){
    return (Math.random() < PROB_50)
      ? { label: "$50 OFF", code: "CONF50" }
      : { label: "20% OFF", code: "CONF20" };
  }

  // ---- Toggle wiring (MUST match your IDs)
  const tabs = [
    { btn: "btnScratch", panel: "panelScratch" },
    { btn: "btnSpin",    panel: "panelSpin"    },
    { btn: "btnSlots",   panel: "panelSlots"   },
    { btn: "btnFit",     panel: "panelFit"     },
    { btn: "btnLaunch",  panel: "panelLaunch"  },
  ];

  function setActive(panelId){
    tabs.forEach(t => {
      const b = document.getElementById(t.btn);
      const p = document.getElementById(t.panel);
      if (!b || !p) return;

      const on = (t.panel === panelId);
      b.classList.toggle("active", on);
      p.classList.toggle("active", on);
    });
  }

  safe(() => {
    tabs.forEach(t => {
      const b = document.getElementById(t.btn);
      if (!b) return;
      b.addEventListener("click", () => setActive(t.panel));
    });
  });

  // =========================
  // SCRATCH (simple + reliable)
  // =========================
  safe(() => {
    const canvas = document.getElementById("scratchCanvas");
    const prizeEl = document.getElementById("scratchPrize");
    const resetBtn = document.getElementById("scratchReset");
    if (!canvas || !prizeEl || !resetBtn) return;

    const ctx = canvas.getContext("2d");
    let isDown = false;

    function cover(){
      ctx.globalCompositeOperation = "source-over";
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // gray cover
      ctx.fillStyle = "#bfbfbf";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // text
      ctx.fillStyle = "rgba(0,0,0,0.45)";
      ctx.font = "bold 22px Arial";
      ctx.textAlign = "center";
      ctx.fillText("SCRATCH HERE", canvas.width/2, canvas.height/2);

      // scratch mode
      ctx.globalCompositeOperation = "destination-out";
    }

    function pos(evt){
      const r = canvas.getBoundingClientRect();
      const t = evt.touches ? evt.touches[0] : evt;
      return {
        x: (t.clientX - r.left) * (canvas.width / r.width),
        y: (t.clientY - r.top) * (canvas.height / r.height)
      };
    }

    function scratch(x,y){
      ctx.beginPath();
      ctx.arc(x,y,18,0,Math.PI*2);
      ctx.fill();
    }

    function newPrize(){
      const p = choosePrize();
      prizeEl.textContent = p.label + "  (code: " + p.code + ")";
      cover();
    }

    canvas.addEventListener("mousedown", e => { isDown=true; const p=pos(e); scratch(p.x,p.y); });
    canvas.addEventListener("mousemove", e => { if(!isDown) return; const p=pos(e); scratch(p.x,p.y); });
    window.addEventListener("mouseup", () => isDown=false);

    canvas.addEventListener("touchstart", e => { isDown=true; const p=pos(e); scratch(p.x,p.y); e.preventDefault(); }, {passive:false});
    canvas.addEventListener("touchmove", e => { if(!isDown) return; const p=pos(e); scratch(p.x,p.y); e.preventDefault(); }, {passive:false});
    canvas.addEventListener("touchend", () => isDown=false);

    resetBtn.addEventListener("click", newPrize);
    newPrize();
  });

  // =========================
  // SPIN (simple wheel + result)
  // =========================
  safe(() => {
    const wheel = document.getElementById("wheel");
    const spinBtn = document.getElementById("spinBtn");
    const resBox = document.getElementById("spinResult");
    const big = document.getElementById("spinBig");
    const small = document.getElementById("spinSmall");
    if (!wheel || !spinBtn || !resBox || !big || !small) return;

    const ctx = wheel.getContext("2d");
    const seg = ["20%","20%","20%","20%","$50","20%","20%","20%"];
    let angle = 0;
    let spinning = false;

    function draw(){
      const W = wheel.width, H = wheel.height;
      const cx = W/2, cy = H/2, r = Math.min(cx,cy) - 6;
      ctx.clearRect(0,0,W,H);
      const arc = (Math.PI*2)/seg.length;

      for(let i=0;i<seg.length;i++){
        const a0 = angle + i*arc;
        const a1 = a0 + arc;
        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.arc(cx,cy,r,a0,a1);
        ctx.closePath();
        ctx.fillStyle = (i%2===0) ? "#e9e9e9" : "#d9d9d9";
        ctx.fill();
        ctx.strokeStyle="#fff";
        ctx.stroke();

        ctx.save();
        ctx.translate(cx,cy);
        ctx.rotate(a0+arc/2);
        ctx.textAlign="right";
        ctx.fillStyle="#111";
        ctx.font="bold 14px Arial";
        ctx.fillText(seg[i], r-12, 5);
        ctx.restore();
      }

      // pointer
      ctx.fillStyle="#111";
      ctx.beginPath();
      ctx.moveTo(cx, cy-r-2);
      ctx.lineTo(cx-10, cy-r+18);
      ctx.lineTo(cx+10, cy-r+18);
      ctx.closePath();
      ctx.fill();
    }

    function easeOut(t){ return 1 - Math.pow(1-t,3); }

    spinBtn.addEventListener("click", () => {
      if (spinning) return;
      spinning = true;
      resBox.style.display="none";

      const prize = choosePrize();
      const targetLabel = (prize.label.includes("50")) ? "$50" : "20%";

      // pick a segment index matching targetLabel
      const idxs = seg.map((s,i)=>({s,i})).filter(x=>x.s===targetLabel).map(x=>x.i);
      const idx = idxs[Math.floor(Math.random()*idxs.length)];

      const arc = (Math.PI*2)/seg.length;
      const pointerAngle = -Math.PI/2;
      const segCenter = idx*arc + arc/2;

      const targetAngle = pointerAngle - segCenter - (Math.PI*2)*(6+Math.random()*3);
      const start = angle;
      const t0 = performance.now();
      const dur = 2200;

      function anim(t){
        const p = Math.min(1,(t-t0)/dur);
        angle = start + (targetAngle-start)*easeOut(p);
        draw();
        if (p<1) requestAnimationFrame(anim);
        else {
          spinning=false;
          big.textContent = "YOU WON " + prize.label;
          small.textContent = "Code (demo): " + prize.code;
          resBox.style.display="block";
        }
      }
      requestAnimationFrame(anim);
    });

    draw();
  });

  // =========================
  // SLOTS (simple)
  // =========================
  safe(() => {
    const spinBtn = document.getElementById("slotsSpin");
    const icons = document.getElementById("slotIcons");
    const res = document.getElementById("slotsResult");
    const big = document.getElementById("slotsBig");
    const small = document.getElementById("slotsSmall");
    if (!spinBtn || !icons || !res || !big || !small) return;

    const pool = ["ğŸ‘“","ğŸ§¿","ğŸ’§","ğŸ”¦","ğŸ“","ğŸ“ˆ","âšªï¸","ğŸ§ "];
    let timer = null;

    spinBtn.addEventListener("click", () => {
      res.style.display="none";
      clearInterval(timer);
      let ticks = 0;

      timer = setInterval(() => {
        const a = pool[Math.floor(Math.random()*pool.length)];
        const b = pool[Math.floor(Math.random()*pool.length)];
        const c = pool[Math.floor(Math.random()*pool.length)];
        icons.textContent = `${a} ${b} ${c}`;
        ticks++;
        if (ticks > 18){
          clearInterval(timer);
          const prize = choosePrize();
          big.textContent = "YOU WON " + prize.label;
          small.textContent = "Code (demo): " + prize.code;
          res.style.display="block";
        }
      }, 70);
    });
  });

  // =========================
  // GLASSES (demo button)
  // =========================
  safe(() => {
    const winBtn = document.getElementById("fitWin");
    const res = document.getElementById("fitResult");
    const big = document.getElementById("fitBig");
    const small = document.getElementById("fitSmall");
    if (!winBtn || !res || !big || !small) return;

    winBtn.addEventListener("click", () => {
      const prize = choosePrize();
      big.textContent = "YOU WON " + prize.label;
      small.textContent = "Code (demo): " + prize.code;
      res.style.display="block";
    });
  });

  // =========================
  // LAUNCH (demo button)
  // =========================
  safe(() => {
    const btn = document.getElementById("launchBtn");
    const res = document.getElementById("launchResult");
    const big = document.getElementById("launchBig");
    const small = document.getElementById("launchSmall");
    if (!btn || !res || !big || !small) return;

    btn.addEventListener("click", () => {
      const prize = choosePrize();
      big.textContent = "YOU WON " + prize.label;
      small.textContent = "Code (demo): " + prize.code;
      res.style.display="block";
    });
  });

  // default
  safe(() => setActive("panelScratch"));
})();
</script>
  
<body>
<div class="wrap">
<h2>ğŸ® OD on the GO Conference Games</h2>
<div class="note">Demo mode â€” no email capture yet</div>

<div class="toggleBar">
  <button id="btnScratch" class="toggleBtn active">ğŸª™ Scratch</button>
  <button id="btnSpin" class="toggleBtn">ğŸ› Spin</button>
  <button id="btnSlots" class="toggleBtn">ğŸ° Slots</button>
  <button id="btnFit" class="toggleBtn">ğŸ‘“ Glasses</button>
  <button id="btnLaunch" class="toggleBtn">ğŸ¹ Launch</button>
</div>

<!-- SCRATCH -->
<div id="panelScratch" class="panel active">
  <h3>ğŸª™ Scratch to Win</h3>
  <canvas id="scratchCanvas" width="480" height="200"
    style="border-radius:12px;border:1px solid #ccc;"></canvas>
  <div id="scratchPrize" style="font-size:28px;font-weight:900;margin-top:10px;">â€”</div>
  <button class="action" id="scratchReset">Play Again</button>
</div>

<!-- SPIN -->
<div id="panelSpin" class="panel">
  <h3>ğŸ› Spin the Phoropter</h3>
  <canvas id="wheel" width="320" height="320"></canvas>
  <button class="action" id="spinBtn">SPIN</button>
  <div id="spinResult" class="result">
    <div class="big" id="spinBig"></div>
    <div class="small" id="spinSmall"></div>
  </div>
</div>

<!-- SLOTS -->
<div id="panelSlots" class="panel">
  <h3>ğŸ° Optometry Slots</h3>
  <div style="font-size:64px" id="slotIcons">ğŸ‘“ ğŸ§¿ ğŸ’§</div>
  <button class="action" id="slotsSpin">SPIN</button>
  <div id="slotsResult" class="result">
    <div class="big" id="slotsBig"></div>
    <div class="small" id="slotsSmall"></div>
  </div>
</div>

<!-- GLASSES -->
<div id="panelFit" class="panel">
  <h3>ğŸ‘“ Put the Glasses On</h3>
  <div style="font-size:90px;margin:20px">ğŸ™‚</div>
  <button class="action" id="fitWin">Snap Glasses</button>
  <div id="fitResult" class="result">
    <div class="big" id="fitBig"></div>
    <div class="small" id="fitSmall"></div>
  </div>
</div>

<!-- LAUNCH -->
<div id="panelLaunch" class="panel">
  <h3>ğŸ¹ Launch the Eye Drop</h3>
  <button class="action" id="launchBtn">LAUNCH</button>
  <div id="launchResult" class="result">
    <div class="big" id="launchBig"></div>
    <div class="small" id="launchSmall"></div>
  </div>
</div>

</div>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>OD on the GO ‚Äî Conference Game Demos</title>

<style>
  body { font-family: Arial, sans-serif; background:#fafafa; margin:0; }
  .wrap { max-width: 1200px; margin: 26px auto; padding: 0 14px; text-align:center; }
  h2 { margin: 0 0 6px; }
  .sub { color:#666; margin: 0 0 16px; }

  .toggleBar{
    display:flex; gap:10px; justify-content:center; flex-wrap:wrap;
    margin:14px auto 22px;
  }
  .toggleBtn{
    padding:12px 14px; border-radius:10px; border:1px solid #ddd;
    background:#fff; font-weight:900; cursor:pointer; min-width: 180px;
  }
  .toggleBtn.active{ background:#111; color:#fff; border-color:#111; }

  .panel{
    display:none; margin:0 auto; max-width: 940px;
    background:#fff; border:1px solid #eee; border-radius:16px;
    padding:18px; box-shadow:0 2px 14px rgba(0,0,0,0.06);
  }
  .panel.active{ display:block; }

  .note{ margin-top:10px; font-size:12px; color:#666; }

  button.action{
    width: 320px; max-width: 100%;
    margin-top:14px;
    padding:12px 16px;
    font-size:16px; font-weight:900;
    border:none; border-radius:10px;
    background:#111; color:#fff; cursor:pointer;
  }
  button.action:disabled{ opacity:0.5; cursor:not-allowed; }

  .result{
    margin:12px auto 0; max-width:560px;
    display:none; padding:12px;
    border:1px solid #cce5ff;
    background:#f0f7ff;
    border-radius:12px;
    text-align:center;
  }
  .result .big{ font-size:22px; font-weight:900; }
  .result .small{ margin-top:6px; font-size:13px; color:#444; }

  /* ========= SCRATCH ========= */
  .scratchStage{ position:relative; width:100%; max-width:480px; margin:0 auto; }
  #scratchCanvas{
    position:relative; z-index:1;
    width:100%; height:auto; border-radius:12px;
    touch-action:none; display:block;
  }
  .scratchUnderlay{
    position:absolute; inset:0; z-index:0;
    background:#f6f6f6; border-radius:12px;
    display:flex; align-items:center; justify-content:center;
    border:1px solid #eee;
  }
  .scratchUnderlay .big{ font-size:36px; font-weight:900; margin-top:6px; }

  /* ========= SPIN ========= */
  .spinStage{ position:relative; width:320px; height:320px; margin:10px auto 10px; }
  #wheel{ width:320px; height:320px; display:block; border-radius:50%; background:#fff; border:1px solid #eee; }
  .pointer{
    position:absolute; top:-10px; left:50%; transform:translateX(-50%);
    width:0; height:0;
    border-left:14px solid transparent;
    border-right:14px solid transparent;
    border-bottom:26px solid #111;
    z-index:5;
  }
  .badge{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; }
  .badge .inner{
    width:120px; height:120px; border-radius:50%;
    background:#fff; border:1px solid #eee;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    box-shadow:0 2px 10px rgba(0,0,0,0.06);
  }
  .badge .emoji{ font-size:44px; line-height:1; }
  .badge .txt{ font-size:12px; color:#555; margin-top:6px; font-weight:900; letter-spacing:0.6px; }

  /* ========= DROP GAME ========= */
  .hud{ display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin:10px 0 14px; }
  .pill{ background:#fff; border:1px solid #eee; border-radius:999px; padding:10px 14px; font-weight:900; }

  .game{
    position:relative;
    margin:0 auto;
    width:min(780px, 100%);
    aspect-ratio:16/10;
    background:#fff;
    border:1px solid #eee;
    border-radius:18px;
    overflow:hidden;
    box-shadow:0 2px 14px rgba(0,0,0,0.06);
    touch-action:none;
  }
  .eyeWrap{
    position:absolute; left:50%; top:48%;
    transform:translate(-50%, -50%);
    width:min(620px, 92%); height:60%;
  }
  .eyeWhite{
    position:absolute; inset:18% 8% 18% 8%;
    background:#f7f7f7;
    border-radius:999px;
    border:2px solid #e6e6e6;
    box-shadow: inset 0 0 0 8px #fff;
    overflow:hidden;
  }
  .iris{
    position:absolute;
    width:26%; aspect-ratio:1/1;
    border-radius:50%;
    left:50%; top:50%;
    transform:translate(-50%, -50%);
    background: radial-gradient(circle at 35% 35%, #6aa6ff, #2b62c9 55%, #1b2b58 100%);
    border:2px solid rgba(0,0,0,0.08);
  }
  .pupil{
    position:absolute;
    width:38%; aspect-ratio:1/1;
    border-radius:50%;
    left:50%; top:50%;
    transform:translate(-50%, -50%);
    background:#111;
  }
  .spark{
    position:absolute;
    width:18%; aspect-ratio:1/1;
    border-radius:50%;
    left:32%; top:28%;
    background: rgba(255,255,255,0.85);
  }
  .lidTop, .lidBot{
    position:absolute; left:0; right:0;
    height:50%;
    background:#fafafa;
    z-index:5;
    transition: transform 110ms linear;
  }
  .lidTop{ top:0; border-bottom:2px solid #eee; transform: translateY(-65%); }
  .lidBot{ bottom:0; border-top:2px solid #eee; transform: translateY(65%); }

  .target{
    position:absolute;
    width:30%; aspect-ratio:1/1;
    left:50%; top:50%;
    transform:translate(-50%, -50%);
    border-radius:50%;
    outline:3px dashed rgba(0,0,0,0.10);
    outline-offset:6px;
    pointer-events:none;
    z-index:2;
  }
  .drop{
    position:absolute;
    width:44px; height:54px;
    border-radius:999px;
    background: radial-gradient(circle at 35% 25%, rgba(255,255,255,0.95), rgba(255,255,255,0.2) 35%, rgba(72,160,255,0.9) 70%, rgba(32,110,210,0.95) 100%);
    box-shadow:0 10px 18px rgba(0,0,0,0.12);
    cursor:grab;
    z-index:10;
  }
  .drop:active{ cursor:grabbing; }
  .tray{
    position:absolute; left:14px; bottom:14px;
    display:flex; gap:10px; align-items:center;
    background:#fff; border:1px solid #eee;
    padding:10px 12px; border-radius:14px;
    z-index:20;
  }
  .tray .label{ font-weight:900; }
  .tiny{ font-size:12px; color:#666; }

  /* ========= SLOTS ========= */
  .machine{
    margin:0 auto; max-width:620px;
    background:#fff; border:1px solid #eee;
    border-radius:18px; padding:18px;
    box-shadow:0 2px 14px rgba(0,0,0,0.06);
  }
  .reels{ display:flex; justify-content:center; gap:12px; margin:14px 0; flex-wrap:wrap; }
  .reel{
    width:160px; height:160px;
    border-radius:16px; border:2px solid #eee;
    background: linear-gradient(#ffffff, #f6f6f6);
    display:flex; align-items:center; justify-content:center;
    font-weight:900; position:relative; overflow:hidden;
  }
  .reelInner{ text-align:center; }
  .reel .icon{ font-size:46px; line-height:1; }
  .reel .label{ margin-top:10px; font-size:14px; color:#222; }
  .shine{
    position:absolute; inset:-40%;
    background: linear-gradient(45deg, rgba(255,255,255,0) 40%, rgba(255,255,255,0.55) 50%, rgba(255,255,255,0) 60%);
    transform: translateX(-40%) rotate(10deg);
    pointer-events:none;
  }

  /* ========= GLASSES FIT ========= */
  .fitStage{
    position: relative;
    margin: 0 auto;
    width: min(780px, 100%);
    aspect-ratio: 16 / 9;
    background:#fff;
    border:1px solid #eee;
    border-radius: 18px;
    overflow:hidden;
    box-shadow: 0 2px 14px rgba(0,0,0,0.06);
    touch-action: none;
  }
  .fitHint{
    position:absolute; left:14px; top:14px;
    background:#fff; border:1px solid #eee;
    padding:10px 12px; border-radius:14px;
    text-align:left; z-index:10;
  }
  .head{
    position:absolute; top:50%;
    transform: translate(-50%, -50%);
    width:260px; height:320px;
    left:50%; z-index:2;
  }
  .head .face{
    position:absolute; inset:0;
    background:#f3f3f3;
    border:2px solid #e6e6e6;
    border-radius:120px 120px 140px 140px;
  }
  .head .hair{
    position:absolute; left:12px; right:12px; top:6px;
    height:86px;
    background:#e8e8e8;
    border-radius:120px 120px 80px 80px;
    border:1px solid #e6e6e6;
  }
  .head .eyes{
    position:absolute; left:0; right:0; top:120px;
    display:flex; justify-content:center; gap:48px;
  }
  .head .eye{
    width:44px; height:28px;
    border-radius:999px;
    background:#fff;
    border:2px solid #e6e6e6;
    position:relative;
  }
  .head .eye:after{
    content:"";
    position:absolute; width:12px; height:12px; border-radius:50%;
    background:#111; left:16px; top:8px;
  }
  .head .nose{
    position:absolute; left:50%; top:158px;
    width:18px; height:36px;
    transform: translateX(-50%);
    border-left:2px solid #e0e0e0;
    border-right:2px solid #e0e0e0;
    border-bottom:2px solid #e0e0e0;
    border-radius:0 0 10px 10px;
  }
  .glassesTarget{
    position:absolute; left:50%; top:132px;
    transform: translateX(-50%);
    width:170px; height:68px;
    border-radius:16px;
    outline:3px dashed rgba(0,0,0,0.10);
    outline-offset:6px;
    pointer-events:none;
    z-index:3;
  }
  .glasses{
    position:absolute;
    width:200px; height:80px;
    left:20px; bottom:18px;
    z-index:6;
    cursor:grab;
    user-select:none;
    -webkit-user-select:none;
    touch-action:none;
  }
  .glasses:active{ cursor:grabbing; }
  .frame{ position:absolute; inset:0; }
  .lens{
    position:absolute;
    width:78px; height:54px;
    top:12px;
    border-radius:16px;
    border:4px solid #111;
    background: rgba(255,255,255,0.2);
  }
  .lens.left{ left:12px; }
  .lens.right{ right:12px; }
  .bridge{
    position:absolute; left:50%; top:36px;
    width:30px; height:10px;
    transform: translateX(-50%);
    border-top:4px solid #111;
    border-radius:10px;
  }
  .arm{
    position:absolute; top:32px;
    width:32px; height:8px;
    background:#111;
    border-radius:8px;
  }
  .arm.left{ left:-18px; }
  .arm.right{ right:-18px; }
  .snap{ animation: snap 160ms ease-out; }
  @keyframes snap{
    0%{ transform: scale(1); }
    60%{ transform: scale(1.06); }
    100%{ transform: scale(1); }
  }

  /* ========= LAUNCH DROP (ANGRY BIRDS STYLE) ========= */
  .launchStage{
    position:relative;
    margin:0 auto;
    width:min(800px,100%);
    aspect-ratio:16/9;
    background:#fff;
    border:1px solid #eee;
    border-radius:18px;
    overflow:hidden;
    box-shadow:0 2px 14px rgba(0,0,0,0.06);
    touch-action:none;
  }
  .launchHint{
    position:absolute; left:14px; top:14px;
    background:#fff; border:1px solid #eee;
    padding:10px 12px; border-radius:14px;
    text-align:left; z-index:10;
  }
  .launchEye{
    position:absolute;
    right:80px;
    top:50%;
    transform:translateY(-50%);
    width:170px;
    height:105px;
    background:#f7f7f7;
    border:3px solid #e0e0e0;
    border-radius:999px;
  }
  .launchEye .pupil{
    position:absolute;
    left:50%; top:50%;
    transform:translate(-50%,-50%);
    width:46px; height:46px;
    border-radius:50%;
    background:#111;
  }
  .launchDrop{
    position:absolute;
    left:120px;
    top:50%;
    transform:translate(-50%,-50%);
    width:44px; height:56px;
    border-radius:999px;
    background: radial-gradient(circle at 35% 25%, #fff, #6aa6ff 70%, #1b4fd6);
    box-shadow:0 10px 18px rgba(0,0,0,0.2);
    cursor:grab;
    touch-action:none;
  }
  .launchDrop:active{ cursor:grabbing; }
</style>
</head>

<body>
  <div class="wrap">
    <h2>üéÆ OD on the GO Mini-Game Demos</h2>
    <div class="sub">Pick one for your conference booth (no email yet).</div>

    <div class="toggleBar">
      <button id="btnScratch" class="toggleBtn active" type="button">ü™ô Scratch</button>
      <button id="btnSpin" class="toggleBtn" type="button">üõû Spin</button>
      <button id="btnDrop" class="toggleBtn" type="button">üíß Drop</button>
      <button id="btnSlots" class="toggleBtn" type="button">üé∞ Slots</button>
      <button id="btnFit" class="toggleBtn" type="button">üë§ Glasses</button>
      <button id="btnLaunch" class="toggleBtn" type="button">üèπ Launch</button>
    </div>

    <!-- ===== SCRATCH ===== -->
    <div id="panelScratch" class="panel active">
      <h3 style="margin:0 0 10px;">ü™ô Scratch to Win</h3>

      <div class="scratchStage">
        <div class="scratchUnderlay">
          <div>
            <div style="font-size:18px;">üéâ YOU WON</div>
            <div id="scratchPrizeText" class="big">‚Äî</div>
            <div style="font-size:12px;color:#666;margin-top:6px;">Scratch to reveal</div>
          </div>
        </div>

        <canvas id="scratchCanvas" width="480" height="220"></canvas>
      </div>

      <button class="action" id="scratchReset" type="button">Play Again</button>
      <div class="note">Odds: mostly 20% off; a few $50 off.</div>
    </div>

    <!-- ===== SPIN ===== -->
    <div id="panelSpin" class="panel">
      <h3 style="margin:0 0 10px;">üõû Spin the Phoropter</h3>

      <div class="spinStage">
        <div class="pointer"></div>
        <canvas id="wheel" width="320" height="320"></canvas>

        <div class="badge">
          <div class="inner">
            <div class="emoji">üëì</div>
            <div class="txt">PHOROPTER</div>
          </div>
        </div>
      </div>

      <button class="action" id="spinBtn" type="button">SPIN</button>

      <div id="spinResult" class="result">
        <div class="big" id="spinResultBig">‚Äî</div>
        <div class="small" id="spinResultSmall">‚Äî</div>
      </div>

      <div class="note">Odds: mostly 20% off; a few $50 off.</div>
    </div>

    <!-- ===== DROP ===== -->
    <div id="panelDrop" class="panel">
      <h3 style="margin:0 0 6px;">üíß Drop the Drop</h3>
      <div class="sub" style="margin:0 0 10px;">Drag the drop into the dashed circle before the eye blinks or looks away.</div>

      <div class="hud">
        <div class="pill">Score: <span id="score">0</span></div>
        <div class="pill">Drops: <span id="shots">0</span>/10</div>
        <div class="pill">Streak: <span id="streak">0</span></div>
      </div>

      <div id="dropGame" class="game" aria-label="Drop game">
        <div class="eyeWrap">
          <div class="eyeWhite">
            <div id="iris" class="iris">
              <div class="pupil"></div>
              <div class="spark"></div>
            </div>
            <div id="target" class="target"></div>
          </div>

          <div id="lidTop" class="lidTop"></div>
          <div id="lidBot" class="lidBot"></div>
        </div>

        <div class="tray">
          <div class="label">üíß Drag the drop</div>
          <div class="tiny">Aim for dashed circle</div>
        </div>

        <div id="drop" class="drop" title="Drag me"></div>
      </div>

      <div id="dropResult" class="result">
        <div class="big" id="dropResultBig">‚Äî</div>
        <div class="small" id="dropResultSmall">‚Äî</div>
        <button id="dropPlayAgain" class="action" type="button">Play Again</button>
      </div>

      <div class="note">Demo only (no email). Odds later: mostly 20% off; a few $50 off.</div>
    </div>

    <!-- ===== SLOTS ===== -->
    <div id="panelSlots" class="panel">
      <h3 style="margin:0 0 6px;">üé∞ Optometry Slots</h3>
      <div class="sub" style="margin:0 0 10px;">Tap SPIN and see what you win (demo mode ‚Äî no email).</div>

      <div class="machine">
        <div class="reels">
          <div class="reel"><div class="shine"></div><div class="reelInner"><div id="sI1" class="icon">üëì</div><div id="sT1" class="label">Phoropter</div></div></div>
          <div class="reel"><div class="shine"></div><div class="reelInner"><div id="sI2" class="icon">üßø</div><div id="sT2" class="label">OCT</div></div></div>
          <div class="reel"><div class="shine"></div><div class="reelInner"><div id="sI3" class="icon">üíß</div><div id="sT3" class="label">Eye Drops</div></div></div>
        </div>

        <button id="slotsSpinBtn" class="action" type="button">SPIN</button>

        <div id="slotsResult" class="result">
          <div class="big" id="slotsResultBig">‚Äî</div>
          <div class="small" id="slotsResultSmall">‚Äî</div>
          <button id="slotsAgainBtn" class="action" type="button" style="margin-top:12px;">Play Again</button>
        </div>

        <div class="note">Odds: mostly 20% off; a few $50 off.</div>
      </div>
    </div>

    <!-- ===== GLASSES FIT ===== -->
    <div id="panelFit" class="panel">
      <h3 style="margin:0 0 6px;">üë§ Put the Glasses On</h3>
      <div class="sub" style="margin:0 0 10px;">Drag the glasses onto the moving face. When they snap on, you win.</div>

      <div id="fitStage" class="fitStage" aria-label="Glasses fitting game">
        <div class="fitHint">
          <div style="font-weight:900;">üëì Drag glasses ‚Üí dashed zone</div>
          <div class="tiny">Head moves left/right</div>
        </div>

        <div id="head" class="head">
          <div class="face"></div>
          <div class="hair"></div>
          <div class="eyes">
            <div class="eye"></div>
            <div class="eye"></div>
          </div>
          <div class="nose"></div>
          <div id="glassesTarget" class="glassesTarget"></div>
        </div>

        <div id="glasses" class="glasses" title="Drag me">
          <div class="frame">
            <div class="arm left"></div>
            <div class="arm right"></div>
            <div class="lens left"></div>
            <div class="lens right"></div>
            <div class="bridge"></div>
          </div>
        </div>
      </div>

      <div id="fitResult" class="result">
        <div class="big" id="fitResultBig">‚Äî</div>
        <div class="small" id="fitResultSmall">‚Äî</div>
        <button id="fitAgainBtn" class="action" type="button">Play Again</button>
      </div>

      <div class="note">Demo only (no email). Odds later: mostly 20% off; a few $50 off.</div>
    </div>

    <!-- ===== LAUNCH DROP ===== -->
    <div id="panelLaunch" class="panel">
      <h3 style="margin:0 0 6px;">üèπ Launch the Eye Drop</h3>
      <div class="sub" style="margin:0 0 10px;">Pull back the drop and release to hit the eye.</div>

      <div id="launchStage" class="launchStage" aria-label="Launch drop game">
        <div class="launchHint">
          <div style="font-weight:900;">üíß Pull back + release</div>
          <div class="tiny">Single shot (conference mode)</div>
        </div>

        <div id="launchEye" class="launchEye">
          <div class="pupil"></div>
        </div>

        <div id="launchDrop" class="launchDrop" title="Pull back then release"></div>
      </div>

      <div id="launchResult" class="result">
        <div class="big" id="launchResultBig">‚Äî</div>
        <div class="small" id="launchResultSmall">‚Äî</div>
        <button id="launchAgainBtn" class="action" type="button">Play Again</button>
      </div>

      <div class="note">Odds: mostly 20% off; a few $50 off.</div>
    </div>

  </div>

<script>
(() => {
  // ===== Shared odds =====
  const PROB_50 = 0.08;
  function choosePrize() {
    return (Math.random() < PROB_50)
      ? { label: "$50 OFF", code: "CONF50" }
      : { label: "20% OFF", code: "CONF20" };
  }

  // ===== Toggle =====
  const btnScratch = document.getElementById("btnScratch");
  const btnSpin = document.getElementById("btnSpin");
  const btnDrop = document.getElementById("btnDrop");
  const btnSlots = document.getElementById("btnSlots");
  const btnFit = document.getElementById("btnFit");
  const btnLaunch = document.getElementById("btnLaunch");

  const panelScratch = document.getElementById("panelScratch");
  const panelSpin = document.getElementById("panelSpin");
  const panelDrop = document.getElementById("panelDrop");
  const panelSlots = document.getElementById("panelSlots");
  const panelFit = document.getElementById("panelFit");
  const panelLaunch = document.getElementById("panelLaunch");

  function setActive(which) {
    btnScratch.classList.toggle("active", which === "scratch");
    btnSpin.classList.toggle("active", which === "spin");
    btnDrop.classList.toggle("active", which === "drop");
    btnSlots.classList.toggle("active", which === "slots");
    btnFit.classList.toggle("active", which === "fit");
    btnLaunch.classList.toggle("active", which === "launch");

    panelScratch.classList.toggle("active", which === "scratch");
    panelSpin.classList.toggle("active", which === "spin");
    panelDrop.classList.toggle("active", which === "drop");
    panelSlots.classList.toggle("active", which === "slots");
    panelFit.classList.toggle("active", which === "fit");
    panelLaunch.classList.toggle("active", which === "launch");

    if (which === "spin") drawWheel();
    if (which === "drop") setDropToStart();
    if (which === "fit") fitResetPositions();
    if (which === "launch") resetLaunch();
  }

  btnScratch.addEventListener("click", () => setActive("scratch"));
  btnSpin.addEventListener("click", () => setActive("spin"));
  btnDrop.addEventListener("click", () => setActive("drop"));
  btnSlots.addEventListener("click", () => setActive("slots"));
  btnFit.addEventListener("click", () => setActive("fit"));
  btnLaunch.addEventListener("click", () => setActive("launch"));

    // =========================
  // ===== SCRATCH GAME ======
  // =========================
  const scratchCanvas = document.getElementById("scratchCanvas");
  const sctx = scratchCanvas.getContext("2d");
  const scratchPrizeText = document.getElementById("scratchPrizeText");
  const scratchReset = document.getElementById("scratchReset");
  let scratching = false;

  function drawScratchCover() {
    sctx.globalCompositeOperation = "source-over";
    sctx.fillStyle = "#bfbfbf";
    sctx.fillRect(0,0,scratchCanvas.width,scratchCanvas.height);
    sctx.fillStyle = "rgba(0,0,0,0.45)";
    sctx.font = "bold 22px Arial";
    sctx.textAlign = "center";
    sctx.fillText("SCRATCH HERE", scratchCanvas.width/2, scratchCanvas.height/2);
    sctx.globalCompositeOperation = "destination-out";
  }

  function scratchDot(x,y){
    sctx.beginPath();
    sctx.arc(x,y,20,0,Math.PI*2);
    sctx.fill();
  }

  function scratchPos(e){
    const r = scratchCanvas.getBoundingClientRect();
    const t = e.touches ? e.touches[0] : e;
    return {
      x:(t.clientX-r.left)*(scratchCanvas.width/r.width),
      y:(t.clientY-r.top)*(scratchCanvas.height/r.height)
    };
  }

  scratchCanvas.addEventListener("mousedown",e=>{scratching=true;const p=scratchPos(e);scratchDot(p.x,p.y);});
  scratchCanvas.addEventListener("mousemove",e=>{if(!scratching)return;const p=scratchPos(e);scratchDot(p.x,p.y);});
  window.addEventListener("mouseup",()=>scratching=false);
  scratchCanvas.addEventListener("touchstart",e=>{scratching=true;const p=scratchPos(e);scratchDot(p.x,p.y);e.preventDefault();},{passive:false});
  scratchCanvas.addEventListener("touchmove",e=>{if(!scratching)return;const p=scratchPos(e);scratchDot(p.x,p.y);e.preventDefault();},{passive:false});
  scratchCanvas.addEventListener("touchend",()=>scratching=false);

  function resetScratch(){
    const prize=choosePrize();
    scratchPrizeText.textContent=prize.label;
    drawScratchCover();
  }
  scratchReset.addEventListener("click",resetScratch);
  resetScratch();

  // =========================
  // ===== SPIN GAME =========
  // =========================
  const wheel=document.getElementById("wheel");
  const wctx=wheel.getContext("2d");
  const spinBtn=document.getElementById("spinBtn");
  const spinResult=document.getElementById("spinResult");
  const spinResultBig=document.getElementById("spinResultBig");
  const spinResultSmall=document.getElementById("spinResultSmall");

  const segments=["20% OFF","20% OFF","20% OFF","20% OFF","$50 OFF","20% OFF","20% OFF","20% OFF"];
  let currentAngle=0, spinning=false;
  const cx=160, cy=160, r=150;

  function drawWheel(){
    wctx.clearRect(0,0,320,320);
    const arc=(Math.PI*2)/segments.length;
    segments.forEach((s,i)=>{
      const a=currentAngle+i*arc;
      wctx.beginPath();
      wctx.moveTo(cx,cy);
      wctx.arc(cx,cy,r,a,a+arc);
      wctx.closePath();
      wctx.fillStyle=i%2?"#d9d9d9":"#ededed";
      wctx.fill();
      wctx.save();
      wctx.translate(cx,cy);
      wctx.rotate(a+arc/2);
      wctx.textAlign="right";
      wctx.font="bold 14px Arial";
      wctx.fillStyle="#111";
      wctx.fillText(s,r-14,5);
      wctx.restore();
    });
  }

  function spin(){
    if(spinning)return;
    spinning=true;
    spinBtn.disabled=true;
    spinResult.style.display="none";
    const prize=choosePrize();
    const spins=6+Math.random()*3;
    const target=-Math.PI/2 - spins*Math.PI*2;
    const start=currentAngle;
    const t0=performance.now();

    function anim(t){
      const p=Math.min(1,(t-t0)/2400);
      currentAngle=start+(target-start)*(1-Math.pow(1-p,3));
      drawWheel();
      if(p<1)requestAnimationFrame(anim);
      else{
        spinResultBig.textContent=prize.label;
        spinResultSmall.textContent="Code (demo): "+prize.code;
        spinResult.style.display="block";
        spinning=false;
        spinBtn.disabled=false;
      }
    }
    requestAnimationFrame(anim);
  }
  spinBtn.addEventListener("click",spin);
  drawWheel();

  // =========================
  // ===== SLOTS ============
  // =========================
  const symbols=["üëì","üßø","üíß","üìè","üìà","‚ö™Ô∏è","üî¶","üß†"];
  const sI=[sI1,sI2,sI3], sT=[sT1,sT2,sT3];
  function randSym(){return symbols[Math.floor(Math.random()*symbols.length)];}
  function setReel(i){sI[i].textContent=randSym();sT[i].textContent="";}
  function slotsSpin(){
    slotsResult.style.display="none";
    sI.forEach((_,i)=>setReel(i));
    const prize=choosePrize();
    setTimeout(()=>{
      slotsResultBig.textContent="üéâ "+prize.label;
      slotsResultSmall.textContent="Code (demo): "+prize.code;
      slotsResult.style.display="block";
    },700);
  }
  slotsSpinBtn.addEventListener("click",slotsSpin);
  slotsAgainBtn.addEventListener("click",()=>slotsResult.style.display="none");

  // =========================
  // ===== GLASSES FIT =======
  // =========================
  let fitWon=false;
  function fitResetPositions(){
    glasses.style.left="20px";
    glasses.style.bottom="18px";
    glasses.style.top="";
    fitResult.style.display="none";
    fitWon=false;
  }

  function overlap(a,b){
    return !(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom);
  }

  glasses.addEventListener("mouseup",()=>{
    if(fitWon)return;
    const g=glasses.getBoundingClientRect();
    const t=glassesTarget.getBoundingClientRect();
    if(overlap(g,t)){
      fitWon=true;
      glasses.classList.add("snap");
      const prize=choosePrize();
      fitResultBig.textContent="üéâ "+prize.label;
      fitResultSmall.textContent="Code (demo): "+prize.code;
      fitResult.style.display="block";
    } else fitResetPositions();
  });
  fitAgainBtn.addEventListener("click",fitResetPositions);

  // =========================
  // ===== LAUNCH DROP =======
  // =========================
  let dragging=false,startX=0;
  launchDrop.addEventListener("mousedown",e=>{
    dragging=true;startX=e.clientX;
  });
  window.addEventListener("mouseup",e=>{
    if(!dragging)return;
    dragging=false;
    const dx=startX-e.clientX;
    launchDrop.style.transition="left .6s ease-out";
    launchDrop.style.left=(120+dx*1.5)+"px";
    setTimeout(()=>{
      const hit=launchDrop.getBoundingClientRect().right>
                launchEye.getBoundingClientRect().left;
      const prize=choosePrize();
      launchResultBig.textContent=(hit?"üéØ Hit! ":"üí• Miss! ")+prize.label;
      launchResultSmall.textContent="Code (demo): "+prize.code;
      launchResult.style.display="block";
    },600);
  });
  launchAgainBtn.addEventListener("click",resetLaunch);

  // DEFAULT
  setActive("scratch");
})();
</script>

</body>
</html>

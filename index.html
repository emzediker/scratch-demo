<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OD on the GO â€“ Conference Scratcher</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f7f7f7;
  margin:0;
  text-align:center;
}

.wrap {
  max-width:700px;
  margin:40px auto;
  padding:20px;
}

.card {
  background:#fff;
  padding:20px;
  border-radius:16px;
  box-shadow:0 4px 16px rgba(0,0,0,.08);
}

input {
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}

button {
  margin-top:14px;
  padding:12px 18px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  background:#111;
  color:#fff;
  cursor:pointer;
}

button:disabled {
  opacity:.5;
  cursor:not-allowed;
}

canvas {
  margin-top:20px;
  border-radius:12px;
  border:1px solid #ddd;
  touch-action:none;
}

.prizeText {
  font-size:26px;
  font-weight:900;
  margin-top:10px;
}

.grand {
  color:#c70000;
  animation:pulse 1s infinite alternate;
}

@keyframes pulse {
  from { transform:scale(1); }
  to { transform:scale(1.05); }
}

.admin {
  margin-top:30px;
  text-align:left;
  font-size:13px;
}

.admin button {
  margin-right:8px;
}
</style>
</head>

<body>

<div class="wrap">
  <div class="card">
    <h2>ðŸŽ‰ Scratch to Win</h2>

    <div id="leadGate">
      <input id="name" placeholder="Full Name">
      <input id="email" placeholder="Email Address">
      <button id="startBtn">Start Game</button>
    </div>

    <div id="gameArea" style="display:none;">
      <div id="prizeLabel" class="prizeText">â€”</div>
      <canvas id="scratchCanvas" width="500" height="220"></canvas>
      <button id="resetBtn" disabled>Next Student</button>
    </div>
  </div>

  <div class="admin">
    <button id="exportBtn">Export CSV</button>
  </div>
</div>

<script>
const STORAGE_KEY = "odgo_leads_v1";

function getLeads(){
  return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
}

function setLeads(data){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

/* ===== PRIZE POOL ===== */

function buildPrizePool(){

  let pool = [];

  // Grand prizes (unique codes â€“ replace later)
  pool.push({label:"FREE PART 1 COURSE", code:"P1_CODE_1", grand:true});
  pool.push({label:"FREE PART 1 COURSE", code:"P1_CODE_2", grand:true});
  pool.push({label:"FREE PART 2 COURSE", code:"P2_CODE_1", grand:true});
  pool.push({label:"FREE PART 2 COURSE", code:"P2_CODE_2", grand:true});
  pool.push({label:"FREE PART 3 COURSE", code:"P3_CODE_1", grand:true});
  pool.push({label:"FREE PART 3 COURSE", code:"P3_CODE_2", grand:true});

  for(let i=0;i<50;i++){
    pool.push({label:"$50 OFF ANY COURSE", code:"CONF50", grand:false});
  }

  for(let i=0;i<500;i++){
    pool.push({label:"20% OFF ANY COURSE", code:"CONF20", grand:false});
  }

  // shuffle
  for(let i=pool.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [pool[i],pool[j]]=[pool[j],pool[i]];
  }

  return pool;
}

let prizePool = buildPrizePool();
let currentPrize = null;

/* ===== SCRATCHER ===== */

const canvas = document.getElementById("scratchCanvas");
const ctx = canvas.getContext("2d");

function drawCover(){
  ctx.globalCompositeOperation="source-over";
  ctx.fillStyle="#bfbfbf";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="rgba(0,0,0,.5)";
  ctx.font="bold 26px Arial";
  ctx.textAlign="center";
  ctx.fillText("SCRATCH HERE",canvas.width/2,canvas.height/2);
  ctx.globalCompositeOperation="destination-out";
}

function scratch(x,y){
  ctx.beginPath();
  ctx.arc(x,y,22,0,Math.PI*2);
  ctx.fill();
}

function getPos(e){
  const r=canvas.getBoundingClientRect();
  const t=e.touches?e.touches[0]:e;
  return {
    x:(t.clientX-r.left)*(canvas.width/r.width),
    y:(t.clientY-r.top)*(canvas.height/r.height)
  };
}

let scratching=false;

canvas.addEventListener("mousedown",e=>{
  scratching=true;
  const p=getPos(e);
  scratch(p.x,p.y);
});

canvas.addEventListener("mousemove",e=>{
  if(!scratching) return;
  const p=getPos(e);
  scratch(p.x,p.y);
});

window.addEventListener("mouseup",()=>scratching=false);

canvas.addEventListener("touchstart",e=>{
  scratching=true;
  const p=getPos(e);
  scratch(p.x,p.y);
  e.preventDefault();
},{passive:false});

canvas.addEventListener("touchmove",e=>{
  if(!scratching) return;
  const p=getPos(e);
  scratch(p.x,p.y);
  e.preventDefault();
},{passive:false});

canvas.addEventListener("touchend",()=>scratching=false);

/* ===== FLOW ===== */

document.getElementById("startBtn").addEventListener("click",()=>{

  const name=document.getElementById("name").value.trim();
  const email=document.getElementById("email").value.trim();

  if(!name || !email){
    alert("Please enter name and email.");
    return;
  }

  if(prizePool.length===0){
    alert("All prizes claimed.");
    return;
  }

  currentPrize = prizePool.pop();

  document.getElementById("leadGate").style.display="none";
  document.getElementById("gameArea").style.display="block";

  const label=document.getElementById("prizeLabel");
  label.textContent=currentPrize.label;

  if(currentPrize.grand){
    label.classList.add("grand");
  } else {
    label.classList.remove("grand");
  }

  drawCover();
});

/* ===== RESET + SAVE ===== */

document.getElementById("resetBtn").addEventListener("click",()=>{
  location.reload();
});

/* ===== EXPORT ===== */

document.getElementById("exportBtn").addEventListener("click",()=>{
  const leads=getLeads();
  if(!leads.length){
    alert("No leads yet.");
    return;
  }

  const header="name,email,prize,code\n";
  const rows=leads.map(l=>`${l.name},${l.email},${l.prize},${l.code}`).join("\n");

  const blob=new Blob([header+rows],{type:"text/csv"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="odgo_leads.csv";
  a.click();
  URL.revokeObjectURL(url);
});
</script>

</body>
</html>
